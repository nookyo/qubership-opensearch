name: Second Workflow
permissions:
    contents: read

    pull-requests: read
    statuses: write

on:
    pull_request:
        types: [opened, synchronize, reopened]
        branches:
            - main
env:
    GITHUB_TOKEN: ${{ github.token }}

jobs:
    wait-for-first:
        runs-on: ubuntu-latest
        steps:
            - name: Wait for First Workflow
              run: |
                  run_id=$(gh run list \
                  --repo "${{ github.repository }}" \
                  --workflow "First Workflow" \
                  --branch "${{ github.head_ref }}" \
                  --event pull_request \
                  --json databaseId \
                  --jq '.[0].databaseId')

                  echo "Watching run $run_id of First Workflow..."
                  gh run watch $run_id --repo "${{ github.repository }}" --exit-status
              env:
                  GH_TOKEN: ${{ github.token }}
    second:
        needs: wait-for-first
        runs-on: ubuntu-latest
        steps:
            - run: echo "ðŸš€ Running Second Workflow after First"
